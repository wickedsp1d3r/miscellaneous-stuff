#!/usr/sbin/nft -f

flush ruleset

table inet filter {

  chain input {
    type filter hook input priority 0; policy drop;
    ct state { related, established } accept
    iif "lo" accept
    ip protocol icmp icmp type != echo-request accept
    udp sport 67 udp dport 68 accept
    tcp sport 8080 accept
    tcp dport { 22000, 22067, 22070 } ct state new accept
    udp dport 21027 ct state new accept
    limit rate 5/minute burst 10 packets log level notice prefix "INPUT-DROP: "
    drop
  }

  chain output {
    type filter hook output priority 0; policy drop;
    ct state established accept
    oif "lo" accept
    ip protocol icmp icmp type != echo-reply accept
    udp sport 68 udp dport 67 accept
    udp dport 53 ip daddr {
      1.0.0.1,
      1.1.1.1,
      149.112.112.112,
      192.112.36.4,
      192.203.230.10,
      192.33.4.12,
      192.36.148.17,
      192.5.5.241,
      192.58.128.30,
      193.0.14.129,
      198.41.0.4,
      198.97.190.53,
      199.7.83.42,
      199.7.91.13,
      199.9.14.201,
      202.12.27.33,
      9.9.9.9
    } ct state new accept
    tcp dport { 22, 43, 80, 443, 465, 587, 853, 993, 8080, 11371, 22000, 22067, 22070 } ct state new accept
    udp dport { 123, 443, 1194, 21027 } ct state new accept
    limit rate 5/minute burst 10 packets log level notice prefix "OUTPUT-DROP: "
    drop
  }

  chain forward {
    type filter hook forward priority 0; policy drop;
    limit rate 5/minute burst 10 packets log level notice prefix "FORWARD-DROP: "
    drop
  }

}
